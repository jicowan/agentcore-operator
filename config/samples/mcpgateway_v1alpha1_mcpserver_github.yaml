apiVersion: mcpgateway.bedrock.aws/v1alpha1
kind: MCPServer
metadata:
  name: mcpserver-github-sample
  labels:
    app.kubernetes.io/name: mcp-gateway-operator
    app.kubernetes.io/managed-by: kustomize
spec:
  # HTTPS endpoint of the MCP server (required)
  # Replace with your actual MCP server endpoint
  endpoint: https://your-mcp-server.example.com

  # Server capabilities - must include "tools" (required)
  capabilities:
    - tools

  # Authentication type: OAuth2 (required for MCP servers)
  # Note: MCP server targets only support OAuth2 authentication
  authType: OAuth2

  # GitHub OAuth provider ARN (required)
  # This should be the ARN of a GitHub OAuth2 credential provider created in Bedrock AgentCore
  # 
  # To create a GitHub OAuth provider:
  # 1. Create a GitHub OAuth App at https://github.com/settings/developers
  # 2. Create the provider in Bedrock AgentCore:
  #    aws bedrock-agentcore-control create-oauth2-credential-provider \
  #      --name my-github-oauth \
  #      --credential-provider-vendor GithubOauth2 \
  #      --oauth2-provider-config-input '{
  #        "githubOauth2ProviderConfig": {
  #          "clientId": "YOUR_GITHUB_CLIENT_ID",
  #          "clientSecret": "YOUR_GITHUB_CLIENT_SECRET"
  #        }
  #      }' \
  #      --region us-west-2
  # 3. Use the returned ARN below
  #
  # Example: arn:aws:bedrock-agentcore:us-west-2:123456789012:token-vault/default/oauth2credentialprovider/my-github-oauth
  oauthProviderArn: arn:aws:bedrock-agentcore:us-east-1:123456789012:token-vault/default/oauth2credentialprovider/my-github-oauth

  # OAuth scopes (optional)
  # Specify the OAuth scopes required by your MCP server
  oauthScopes:
    - read
    - write

  # Optional: Description for the gateway target
  description: "MCP server with GitHub OAuth2 authentication"

  # Optional: Custom target name (defaults to resource name)
  # targetName: my-github-target

  # Optional: Gateway ID (defaults to GATEWAY_ID environment variable)
  # gatewayId: gateway-abc123

---
# Example for testing with the mock MCP server
apiVersion: mcpgateway.bedrock.aws/v1alpha1
kind: MCPServer
metadata:
  name: test-mcp-github
  namespace: default
spec:
  # Replace with your mock server's LoadBalancer endpoint
  # Get it with: kubectl get svc -n mock-mcp-server mock-mcp-server -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'
  endpoint: https://your-loadbalancer-url.elb.amazonaws.com
  
  capabilities:
    - tools
  
  authType: OAuth2
  
  # Replace with your GitHub OAuth provider ARN
  oauthProviderArn: arn:aws:bedrock-agentcore:us-west-2:123456789012:token-vault/default/oauth2credentialprovider/test-github-oauth
  
  oauthScopes:
    - read
    - write
  
  description: "Test MCP server with GitHub OAuth2 - mock server"
